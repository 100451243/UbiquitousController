<html>
<head>
<title>Node.js</title>
</head>
<body>
<h1>Noflix</h1>
<p>Welcome to this website. Scan this qr to begin controlling the website</p>
<!-- Show qrcode.png
-->
<img src="qrcode.png" alt="QRcode for login. If you are reading this something is wrong" />
<p> You have been assigned user: </p>
<p id="user"></p>

<script>
    let user = document.getElementById("user");
    //save cookie "id" in user.innerHTML
    user.innerHTML = document.cookie;

    window.getCookie = function(name) {
        let match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
        if (match) return match[2];
    }



    let socket = new WebSocket(location.origin.replace(/^http/, 'ws'));
    socket.onopen = function(e) {
        console.log("[open] Connection established, Sending to server");
        socket.send(JSON.stringify({"action":"waitLogin", "id":getCookie("id")}))
    };
    socket.onmessage = function(event) {
        console.log(`[message] Data received from server: ${event.data}`);
        try {
            const data = JSON.parse(event.data);
            if (data.action === "reload" && data.id === getCookie("id")) {
                document.location.reload();
                alert("reloading")
            }
        } catch (e) {}
    };
    socket.onclose = function(event) {
        if (event.wasClean) {
            alert(`[close] Connection closed cleanly, code=${event.code} reason=${event.reason}`);
        } else {
            // e.g. server process killed or network down
            // event.code is usually 1006 in this case
            alert('[close] Connection died');
        }
    };
    socket.onerror = function(error) {
        alert(`[error]` + error.message);
    };



</script>
<!--<script>-->
<!--    setTimeout(function () { location.reload(); }, 1000);-->
<!--</script>-->
</body>
</html>
