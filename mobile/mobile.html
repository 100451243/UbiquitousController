<!DOCTYPE html>
<html>
    <head>
        <title>Ubiquitous Controller</title>        
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no, width=device-width">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <link rel="stylesheet" href="mobile.css">
        <script src="pureknob.js" type="text/javascript"></script>
    </head>
    <body>
        <div id="main-screen">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 403.44 74.33" id="squiggle-svg">
                <path id="squiggle" fill="none" stroke="#bc85ff" stroke-miterlimit="10" stroke-width="15" d="M14.2 65.54s36-36.79 56.31-35.66 38.6 27.31 58.13 26.56 26.34-5.91 37.6-13 30.53-19.52 39.48-19.14 19.48 8.23 31.12 19.87 18.91 13.2 25.25 13.16S278.24 58 297 40.76s25.86-17.86 31.49-17.86 48.11 15.42 65 13.27" />
            </svg>
            <div id="modal-info-box">
                <div class="modal-header">
                    <h1>Controles</h1>
                </div>
                <div class="modal-content">bla bla bla</p>
                </div>
                <div class="button">
                    <div id="button-ok">OK</div>
                </div>
            </div>
            <div id="control-knob"></div>
            <div id="zoom-square"></div>
        </div>
        
        <div id="info-circle">
            <i class="fa fa-info-circle"></i>
        </div>
        
        <div id="circle-tap"></div>
        
    </body>
    <script>

        window.getCookie = function(name) {
            let match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
            if (match) return match[2];
        }

        let socket = new WebSocket("ws://192.168.24.226:8080");
        socket.onopen = function(e) {
            console.log("[open] Connection established");
            console.log("Sending to server");
            socket.send("My name is John");
            socket.send(JSON.stringify({"action":"login", "id":document.cookie}))
        };
        socket.onmessage = function(event) {
            console.log(`[message] Data received from server: ${event.data}`);
            try {
                const data = JSON.parse(event.data);
                if (data.action === "films" && data.id === getCookie("id")) {
                    var info_box = document.querySelector("#modal-info-box");

                    document.querySelector(".modal-content").innerHTML = data.films;
                    alert("reloading")
                }
            } catch (e) {}
        };
        socket.onclose = function(event) {
            if (event.wasClean) {
                alert(`[close] Connection closed cleanly, code=${event.code} reason=${event.reason}`);
            } else {
                // e.g. server process killed or network down
                // event.code is usually 1006 in this case
                alert('[close] Connection died');
            }
        };
        socket.onerror = function(error) {
            alert(`[error]` + error.message);
        };
    </script>
    <script type="text/javascript" src="speech_recog.js"></script>
    <script type="text/javascript" src="animations.js"></script>
    <script type="text/javascript" src="touch_actions.js"></script>
</html>